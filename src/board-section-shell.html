<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/juicy-html/juicy-html.html">

<link rel="import" href="board-card.html">
<link rel="import" href="board-stick-manage-bar.html">

<link rel="import" href="shared-styles-normalize.html">
<link rel="import" href="shared-styles.html">

<dom-module id="board-section-shell">
    <template>

        <style include="shared-styles-normalize shared-styles iron-flex">
            :host {
                @apply(--layout-vertical);
                font-size: 20px;
                box-sizing: border-box;

                /* bg */
                background-color: var(--board-global-background);
                background-image: var(--board-global-background-image);
                background-origin: var(--board-global-background-origin);
                background-position: var(--board-global-background-position);
                background-attachment: var(--board-global-background-attachment);
                background-repeat: var(--board-global-background-repeat);
                background-size: var(--board-global-background-size);

                color: var(--board-global-text-color);
                transition: 1s all 0.5s ease;
            }

            #container {
                width: 100%;
                /* bg */
                background-image: var(--board-container-background-image);
                background-origin: var(--board-container-background-origin);
                background-position: var(--board-container-background-position);
                background-attachment: var(--board-container-background-attachment);
                background-repeat: var(--board-container-background-repeat);
                background-size: var(--board-container-background-size);
            }
            #dialog {
                bottom: 0px;
                min-width: 180px;
                max-width: 680px;
                margin-top: 80px;

            }

            @media (max-width: 650px) {
                img {
                    width: 100%;
                }
            }
        </style>

        <div id="container">
            <paper-dialog id="dialog" >
                <h2>Item edit dialog</h2>
                <p>Selected: [[dialog.post.serialNumber]]</p>
                <p>index: [[dialog.index]]</p>
                <paper-dialog-scrollable>[[dialog.post.content]]</paper-dialog-scrollable>
                <div class="buttons">
                    <button dialog-dismiss on-tap="_onRemovePostItem">Remove post item.</button>
                </div>
            </paper-dialog>
            <dom-repeat items="[[data]]" as="post">
                <template>
                    <!-- 原則上需要在沒有任何Style的情況下能閱讀的最簡單內容 -->

                    <board-card index$="[[index]]"
                                type$="[[post.type]]"
                                post-serial="[[post.serial]]"
                                first-post="[[post.firstPostSerialNumber]]">
                        <!-- Title -->
                        <dom-if if="[[post.title]]">
                            <template><h1 slot="title">[[post.title]]</h1></template>
                        </dom-if>

                        <!-- Info -->
                        <span slot="day">[[post.postDay]]</span>
                        <span slot="time">[[post.postTime]]</span>
                        <span slot="id">[[post.userId]]</span>
                        <span slot="serial">[[post.serialNumber]]</span>
                        <br>
                        <board-stick-manage-bar  on-tap="_onOpenDialog"
                                serial-number="[[post.serialNumber]]"
                                post-length="[[post.postLength]]"
                                media-type="[[post.mediaType]]"
                                media-host="[[post.mediaHost]]">
                        </board-stick-manage-bar>
                        <!-- media -->
                        <dom-if if="[[post.imgThumbnailUrl]]">
                            <template>
                                <a slot="img" href="" id="imageAnchor">
                                    <img src$="[[post.imgThumbnailUrl]]" alt$="[[post.imgUrl]]">
                                </a>
                            </template>
                        </dom-if>

                        <!-- article -->
                        <p slot="content">
                            <template is="juicy-html" html="[[post.content]]"></template>
                        </p>
                    </board-card>
                </template>
            </dom-repeat>
        </div>
    </template>

    <script>
        class BoardSectionShell extends Polymer.Element {
            static get is() {
                return 'board-section-shell';
            }

            static get properties() {
                return {
                    data: Object,
                };
            }

            ready() {
                super.ready();
            }
            _onOpenDialog(e) {
                console.log(e.model);
                this.dialog = e.model;
                this.$.dialog.open();
            }
            _onRemovePostItem(e) {
                console.log(this.dialog.serialNumber);
                this.dispatchEvent(new CustomEvent('remove-post-item', {
                    bubbles: true, composed: true, detail: {
                        serialNumber: this.dialog.post.serialNumber,
                        index: this.dialog.index,
                    },
                }));
            }
        }


        window.customElements.define(BoardSectionShell.is, BoardSectionShell);
    </script>
</dom-module>
